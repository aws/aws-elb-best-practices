# Vulnerability Management

## Desync mitigation (ALB only)

[HTTP desync attack, or HTTP request smuggling attacks,](https://en.wikipedia.org/wiki/HTTP_request_smuggling){:target="_blank"} aim to exploit different interpretation of RFC non-compliant HTTP requests across a chain of proxies, opening up the possibility of smuggling a request to the back-end.

Application Load Balancer (ALB) supports [HTTP Desync Mitigation Mode](https://docs.aws.amazon.com/elasticloadbalancing/latest/application/application-load-balancers.html#desync-mitigation-mode){:target="_blank"} that classify every request based on its threat level using an AWS Open Source library called [HTTP Desync Guardian](https://github.com/aws/http-desync-guardian){:target="_blank"}.

Customers can choose among three modes - “Defensive”, “Strictest”, and “Monitor”. The “Strictest” mode ensure that your application only sees requests that are [RFC 7230](https://datatracker.ietf.org/doc/html/rfc7230){:target="_blank"} compliant.

The “Strictest” mode is recommended from the security perspective. However, to avoid false positives, users may want to keep it in the “Monitor” mode for some time, and monitor the [DesyncMitigationMode_NonCompliant_Request_Count CloudWatch metric](https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-cloudwatch-metrics.html#load-balancer-metrics-alb){:target="_blank"}. Also, the “classification” and "classification_reason" fields in the Access Logs should be evaluated to determine the impact of enabling “Strictest” mode.

!!! tip "Best Practice"
--8<-- "alb-bp-sec14.md"

!!! note "Note"
    The feature drop_invalid_header_fields was initially intended to provide mitigation for HTTP desync attacks, and was deprecated for this purpose by the HTTP desync mitigation mode feature.

!!! abstract "References and Further Reading"

    [ALB Documentation - Desync mitigation mode](https://docs.aws.amazon.com/elasticloadbalancing/latest/application/application-load-balancers.html#desync-mitigation-mode){:target="_blank"}

    [Application and Classic Load Balancers are adding defense in depth with the introduction of Desync Mitigation Mode](https://aws.amazon.com/about-aws/whats-new/2020/08/application-and-classic-load-balancers-adding-defense-in-depth-with-introduction-of-desync-mitigation-mode/){:target="_blank"}

    [AWS Config Rule alb-desync-mode-check](https://docs.aws.amazon.com/config/latest/developerguide/alb-desync-mode-check.html){:target="_blank"}

    [HTTP Desync Guardian](https://github.com/aws/http-desync-guardian){:target="_blank"}

    [Application Load Balancer should be configured with defensive or strictest desync mitigation mode](https://docs.aws.amazon.com/securityhub/latest/userguide/elb-controls.html#elb-12){:target="_blank"}